# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class Keylightd < Formula
  desc "Daemon and CLI tool for managing Elgato Key Lights on your local network"
  homepage "https://github.com/jmylchreest/keylightd"
  version "0.0.14"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/jmylchreest/keylightd/releases/download/v0.0.14/keylightd_0.0.14_darwin_amd64.tar.gz"
      sha256 "6ababb3bf4db579699f890a813347a65646a2b9bbce874bc457d60eefd839574"

      def install
        bin.install "keylightd"
        bin.install "keylightctl"

        service do
          run bin/"keylightd"
          keep_alive true
          restart_delay 5
          process_type background
          run_type :immediate
        end
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/jmylchreest/keylightd/releases/download/v0.0.14/keylightd_0.0.14_darwin_arm64.tar.gz"
      sha256 "fc844e621f9e9dc8cd1772b3e0d74d73abf3ec0944c837023f285d9f71d0c403"

      def install
        bin.install "keylightd"
        bin.install "keylightctl"

        service do
          run bin/"keylightd"
          keep_alive true
          restart_delay 5
          process_type background
          run_type :immediate
        end
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel? and Hardware::CPU.is_64_bit?
      url "https://github.com/jmylchreest/keylightd/releases/download/v0.0.14/keylightd_0.0.14_linux_amd64.tar.gz"
      sha256 "730afb3444ec39da3e1db217f1d1c07f63effd2850b9272e1564c2c6e755921e"
      def install
        bin.install "keylightd"
        bin.install "keylightctl"

        service do
          run bin/"keylightd"
          keep_alive true
          restart_delay 5
          process_type background
          run_type :immediate
        end
      end
    end
    if Hardware::CPU.arm? and Hardware::CPU.is_64_bit?
      url "https://github.com/jmylchreest/keylightd/releases/download/v0.0.14/keylightd_0.0.14_linux_arm64.tar.gz"
      sha256 "2fd1c19a103a82fe700383a0a8e78f8042efd7b4cfc030aef2086f7024ebf84a"
      def install
        bin.install "keylightd"
        bin.install "keylightctl"

        service do
          run bin/"keylightd"
          keep_alive true
          restart_delay 5
          process_type background
          run_type :immediate
        end
      end
    end
  end

  def caveats
    <<~EOS
      keylightd daemon has been installed!

      To start keylightd manually:
        keylightd

      To start automatically on boot:

      On Linux with systemd:
        systemctl --user enable keylightd
        systemctl --user start keylightd

      Once started, control your lights with:
        keylightctl light list
        keylightctl --help

      Configuration will be created at: ~/.config/keylight/
    EOS
  end

  test do
    system "#{bin}/keylightd", "-h"
    system "#{bin}/keylightctl", "version"
  end
end
